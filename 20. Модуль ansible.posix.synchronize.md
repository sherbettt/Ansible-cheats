[ansible.posix.synchronize module](https://docs.ansible.com/ansible/latest/collections/ansible/posix/synchronize_module.html)

–ú–æ–¥—É–ª—å **`ansible.posix.synchronize`** –≤ Ansible –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –º–µ–∂–¥—É —É–ø—Ä–∞–≤–ª—è—é—â–∏–º —É–∑–ª–æ–º (control node) –∏ —Ü–µ–ª–µ–≤—ã–º–∏ —É–∑–ª–∞–º–∏ (managed nodes) –∏–ª–∏ –º–µ–∂–¥—É —É–¥–∞–ª—ë–Ω–Ω—ã–º–∏ —É–∑–ª–∞–º–∏.  

### üîπ **–î–ª—è –Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏–º –º–æ–¥—É–ª—å**  
–ú–æ–¥—É–ª—å –Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –ø–æ—Å—Ç–∞–≤–∫—É Ansible. –û–Ω —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –∫–æ–ª–ª–µ–∫—Ü–∏–∏ **`ansible.posix`**, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ:  

```bash
ansible-galaxy collection install ansible.posix
```


### üîπ **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
1. **–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫** (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `rsync` –∏–ª–∏ `scp`).  
2. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ** (—É–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤ –Ω–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ, –µ—Å–ª–∏ –æ–Ω–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ).  
3. **–†–∞–±–æ—Ç–∞ –≤ push- –∏ pull-—Ä–µ–∂–∏–º–∞—Ö**:  
   - **Push** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) ‚Äì —Ñ–∞–π–ª—ã –∫–æ–ø–∏—Ä—É—é—Ç—Å—è —Å —É–ø—Ä–∞–≤–ª—è—é—â–µ–≥–æ —É–∑–ª–∞ –Ω–∞ —Ü–µ–ª–µ–≤–æ–π.  
   - **Pull** ‚Äì —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å —Ü–µ–ª–µ–≤–æ–≥–æ —É–∑–ª–∞ –Ω–∞ —É–ø—Ä–∞–≤–ª—è—é—â–∏–π.  
4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SSH –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö**.  
5. **–ì–∏–±–∫–æ—Å—Ç—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ** (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∏ –≥—Ä—É–ø–ø—ã).  


### üîπ **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```yaml
- name: Synchronize files from control node to remote server
  ansible.posix.synchronize:
    src: /local/path/
    dest: /remote/path/
    delete: yes  # —É–¥–∞–ª—è—Ç—å –ª–∏—à–Ω–∏–µ —Ñ–∞–π–ª—ã –Ω–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ
    recursive: yes  # –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ
```

### üîπ **–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
| –ü–∞—Ä–∞–º–µ—Ç—Ä      | –û–ø–∏—Å–∞–Ω–∏–µ                                                                 |
|--------------|-------------------------------------------------------------------------|
| `src`        | –ò—Å—Ç–æ—á–Ω–∏–∫ (–ª–æ–∫–∞–ª—å–Ω—ã–π –∏–ª–∏ —É–¥–∞–ª—ë–Ω–Ω—ã–π –ø—É—Ç—å).                                |
| `dest`       | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ (–∫—É–¥–∞ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å).                                          |
| `mode`       | –†–µ–∂–∏–º: `push` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –∏–ª–∏ `pull`.                               |
| `delete`     | –£–¥–∞–ª—è—Ç—å –ª–∏ —Ñ–∞–π–ª—ã –≤ `dest`, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ `src` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `no`).    |
| `recursive`  | –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `yes`).                          |
| `archive`    | –°–æ—Ö—Ä–∞–Ω—è—Ç—å –∞—Ç—Ä–∏–±—É—Ç—ã —Ñ–∞–π–ª–æ–≤ (–∫–∞–∫ –≤ `rsync -a`, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `yes`).      |

-------------------------------

–ú–æ–¥—É–ª—å **`ansible.posix.synchronize`** —è–≤–ª—è–µ—Ç—Å—è –æ–±—ë—Ä—Ç–∫–æ–π –≤–æ–∫—Ä—É–≥ **`rsync`** –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –≥–∏–±–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤. –ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥—ë–Ω **–ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤** —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è.  


## üìå **–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**
| –ü–∞—Ä–∞–º–µ—Ç—Ä              | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π? | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------------------|------|--------------|-------------|----------|
| **`src`**            | str  | ‚úÖ –î–∞ | ‚Äî | –ü—É—Ç—å –∫ –∏—Å—Ö–æ–¥–Ω—ã–º —Ñ–∞–π–ª–∞–º (–ª–æ–∫–∞–ª—å–Ω—ã–π –∏–ª–∏ —É–¥–∞–ª—ë–Ω–Ω—ã–π). |
| **`dest`**           | str  | ‚úÖ –î–∞ | ‚Äî | –ü—É—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (–∫—É–¥–∞ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å). |
| **`mode`**           | str  | ‚ùå –ù–µ—Ç | `push` | –†–µ–∂–∏–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: `push` (—Å control node –Ω–∞ managed node) –∏–ª–∏ `pull` (—Å managed node –Ω–∞ control node). |
| **`archive`**        | bool | ‚ùå –ù–µ—Ç | `yes` | –ê–Ω–∞–ª–æ–≥ `rsync -a` (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–∞–≤–∞, –≤–ª–∞–¥–µ–ª—å—Ü–∞, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –∏ —Å–∏–º–ª–∏–Ω–∫–∏). |
| **`recursive`**      | bool | ‚ùå –ù–µ—Ç | `yes` | –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π. |
| **`delete`**         | bool | ‚ùå –ù–µ—Ç | `no` | –£–¥–∞–ª—è—Ç—å –ª–∏ —Ñ–∞–π–ª—ã –≤ `dest`, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ `src`. |
| **`compress`**       | bool | ‚ùå –ù–µ—Ç | `yes` | –°–∂–∞—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ (`rsync -z`). |
| **`checksum`**       | bool | ‚ùå –ù–µ—Ç | `no` | –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã —Ñ–∞–π–ª–æ–≤ –≤–º–µ—Å—Ç–æ —Ä–∞–∑–º–µ—Ä–∞ –∏ –≤—Ä–µ–º–µ–Ω–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏. |
| **`times`**          | bool | ‚ùå –ù–µ—Ç | `yes` | –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ (`-t` –≤ `rsync`). |
| **`owner`**          | bool | ‚ùå –ù–µ—Ç | `no` | –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ (`-o` –≤ `rsync`). –¢—Ä–µ–±—É–µ—Ç root-–ø—Ä–∞–≤. |
| **`group`**          | bool | ‚ùå –ù–µ—Ç | `no` | –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≥—Ä—É–ø–ø—É (`-g` –≤ `rsync`). –¢—Ä–µ–±—É–µ—Ç root-–ø—Ä–∞–≤. |
| **`links`**          | bool | ‚ùå –ù–µ—Ç | `yes` | –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–∏–º–ª–∏–Ω–∫–∏ –∫–∞–∫ —Å–∏–º–ª–∏–Ω–∫–∏ (`-l` –≤ `rsync`). |
| **`perms`**          | bool | ‚ùå –ù–µ—Ç | `no` | –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∞–≤–∞ (`-p` –≤ `rsync`). |



## üìå **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**
| –ü–∞—Ä–∞–º–µ—Ç—Ä              | –¢–∏–ø | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------------------|------|-------------|----------|
| **`rsync_path`**     | str  | `rsync` | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å –∫ `rsync` –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–º —É–∑–ª–µ. |
| **`rsync_timeout`**  | int  | `10` | –¢–∞–π–º–∞—É—Ç (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö) –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `rsync`. |
| **`set_remote_user`**| bool | `yes` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `remote_user` –¥–ª—è `rsync` (–µ—Å–ª–∏ `no`, —Ç–æ `ansible_user`). |
| **`use_ssh_args`**   | bool | `no` | –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å SSH-–∞—Ä–≥—É–º–µ–Ω—Ç—ã Ansible –≤ `rsync` (`-e "ssh -o Port=2222"`). |
| **`ssh_args`**       | str  | ‚Äî | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã SSH (–Ω–∞–ø—Ä–∏–º–µ—Ä, `-o StrictHostKeyChecking=no`). |
| **`private_key`**    | str  | ‚Äî | –ü—É—Ç—å –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –∫–ª—é—á—É SSH –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. |
| **`rsync_opts`**     | list | `[]` | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ `rsync` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `--exclude=.git`). |



## üìå **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤**
| –ü–∞—Ä–∞–º–µ—Ç—Ä              | –¢–∏–ø | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------------------|------|-------------|----------|
| **`exclude`**        | str/list | ‚Äî | –ò—Å–∫–ª—é—á–∏—Ç—å —Ñ–∞–π–ª—ã/–ø–∞—Ç—Ç–µ—Ä–Ω—ã (–∞–Ω–∞–ª–æ–≥ `--exclude` –≤ `rsync`). |
| **`include`**        | str/list | ‚Äî | –í–∫–ª—é—á–∏—Ç—å —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã/–ø–∞—Ç—Ç–µ—Ä–Ω—ã. |
| **`dirs`**           | bool | `yes` | –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (–µ—Å–ª–∏ `no`, —Ç–æ —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã). |
| **`copy_links`**     | bool | `no` | –†–∞–∑—ã–º–µ–Ω–æ–≤—ã–≤–∞—Ç—å —Å–∏–º–ª–∏–Ω–∫–∏ (–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω–∏ —É–∫–∞–∑—ã–≤–∞—é—Ç). |



## üìå **–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**
### 1Ô∏è‚É£ –ü—Ä–æ—Å—Ç–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (–∞–Ω–∞–ª–æ–≥ `rsync -a`)
```yaml
- name: Sync local dir to remote server
  ansible.posix.synchronize:
    src: /local/files/
    dest: /remote/files/
    delete: yes  # —É–¥–∞–ª—è—Ç—å –ª–∏—à–Ω–∏–µ —Ñ–∞–π–ª—ã
```

### 2Ô∏è‚É£ Pull-—Ä–µ–∂–∏–º (—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–∞)
```yaml
- name: Download files from remote server
  ansible.posix.synchronize:
    src: /remote/files/
    dest: /local/backup/
    mode: pull
```

### 3Ô∏è‚É£ –° –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –æ–ø—Ü–∏—è–º–∏ rsync
```yaml
- name: Sync with custom rsync options
  ansible.posix.synchronize:
    src: /app/
    dest: /backup/app/
    rsync_opts:
      - "--exclude=tmp/"
      - "--exclude=*.log"
    compress: no
```

### 4Ô∏è‚É£ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å SSH-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
```yaml
- name: Sync using custom SSH port
  ansible.posix.synchronize:
    src: /data/
    dest: /mnt/backup/
    ssh_args: "-o Port=2222"
    private_key: "~/.ssh/custom_key"
```


## ‚ùó **–í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è**
- –ú–æ–¥—É–ª—å —Ç—Ä–µ–±—É–µ—Ç **—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ `rsync`** –Ω–∞ —É–ø—Ä–∞–≤–ª—è—é—â–µ–º –∏ —Ü–µ–ª–µ–≤–æ–º —É–∑–ª–∞—Ö.
- –î–ª—è —Ä–∞–±–æ—Ç—ã —Å **–≤–ª–∞–¥–µ–ª—å—Ü–µ–º (`owner`) –∏ –≥—Ä—É–ø–ø–æ–π (`group`)** –Ω—É–∂–Ω—ã **root-–ø—Ä–∞–≤–∞**.
- –ï—Å–ª–∏ `dest` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –æ–Ω –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω.
- –ü—Ä–∏ `delete: yes` **—É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —Ñ–∞–π–ª—ã –≤ `dest`, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ `src`** (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!).

-------------

```yaml
    - name: Sync dumps to backup server
      ansible.posix.synchronize:
        mode: push
        src: "{{ item.path }}"
#        dest: "{{ groups['targets'][0] }}:/usr/local/runtel/storage_files/telecoms/runtel.org/{{ inventory_hostname }}/{{ ansible_date_time.date }}/"
        dest: "/usr/local/runtel/storage_files/telecoms/runtel.org/{{ inventory_hostname }}/{{ ansible_date_time.date }}/"
        rsync_opts:
          - "--perms"
          - "--verbose"
        private_key: "~/.ssh/id_rsa"  # –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –∫–ª—é—á—É –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
        archive: no                   # –û—Ç–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø—Ü–∏–∏ (-rlptgoD)
        checksum: yes
        compress: yes
      delegate_to: "{{ groups['targets'][0] }}"
      loop: "{{ tmp_dumps.files }}"
      when: tmp_dumps.matched > 0 and ssh_check is success
      register: sync_results
      ignore_errors: yes
      changed_when: sync_results.rc == 0 or sync_results.rc == 23
      failed_when: sync_results.rc not in [0, 23, 24, 30]
```

## üìå **–†–∞–∑–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–æ–¥—É–ª—è**
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–±—ä—è—Å–Ω–µ–Ω–∏–µ |
|----------|----------|------------|
| **`mode: push`** | `push` | –†–µ–∂–∏–º "–æ—Ç–ø—Ä–∞–≤–∫–∏" —Ñ–∞–π–ª–æ–≤ —Å —É–ø—Ä–∞–≤–ª—è—é—â–µ–≥–æ —É–∑–ª–∞ –Ω–∞ —Ü–µ–ª–µ–≤–æ–π. |
| **`src`** | `{{ item.path }}` | –ò—Å—Ç–æ—á–Ω–∏–∫ —Ñ–∞–π–ª–æ–≤ (–±–µ—Ä—ë—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `tmp_dumps.files` –≤ —Ü–∏–∫–ª–µ). |
| **`dest`** | `/usr/local/runtel/storage_files/...` | –ü—É—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ. –§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º: <br> - `inventory_hostname` (–∏–º—è —Ç–µ–∫—É—â–µ–≥–æ —Ö–æ—Å—Ç–∞), <br> - `ansible_date_time.date` (—Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞). |
| **`rsync_opts`** | `--perms`, `--verbose` | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ `rsync`: <br> - `--perms` ‚Äì —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞, <br> - `--verbose` ‚Äì –ø–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥. |
| **`private_key`** | `~/.ssh/id_rsa` | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–π SSH-–∫–ª—é—á –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. |
| **`archive: no`** | `no` | –û—Ç–∫–ª—é—á–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ–ø—Ü–∏–∏ `rsync -a` (`-rlptgoD`). |
| **`checksum: yes`** | `yes` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã —Ñ–∞–π–ª–æ–≤ –≤–º–µ—Å—Ç–æ –≤—Ä–µ–º–µ–Ω–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏. |
| **`compress: yes`** | `yes` | –í–∫–ª—é—á–∞–µ—Ç —Å–∂–∞—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ (`rsync -z`). |



## üîÑ **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**
### **1. –¶–∏–∫–ª (`loop`)**  
```yaml
loop: "{{ tmp_dumps.files }}"
```
- –ü–µ—Ä–µ–±–∏—Ä–∞–µ—Ç —Ñ–∞–π–ª—ã –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `tmp_dumps.files` (–≤–µ—Ä–æ—è—Ç–Ω–æ, –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `find` –∏–ª–∏ –ø–æ–¥–æ–±–Ω—ã–π –º–æ–¥—É–ª—å).  
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è.

### **2. –£—Å–ª–æ–≤–∏–µ (`when`)**  
```yaml
when: tmp_dumps.matched > 0 and ssh_check is success
```
- –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏**:  
  - `tmp_dumps.matched > 0` ‚Äì –Ω–∞–π–¥–µ–Ω—ã —Ñ–∞–π–ª—ã –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏,  
  - `ssh_check is success` ‚Äì –ø—Ä–æ–≤–µ—Ä–∫–∞ SSH-–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ.

### **3. –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (`delegate_to`)**  
```yaml
delegate_to: "{{ groups['targets'][0] }}"
```
- –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–Ω–µ –Ω–∞ —Ç–µ–∫—É—â–µ–º —Ö–æ—Å—Ç–µ**, –∞ –Ω–∞ –ø–µ—Ä–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ –∏–∑ –≥—Ä—É–ø–ø—ã `targets`.  
- –≠—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã `rsync` —Ä–∞–±–æ—Ç–∞–ª –Ω–∞–ø—Ä—è–º—É—é –º–µ–∂–¥—É –∏—Å—Ö–æ–¥–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–æ–º –∏ –±—ç–∫–∞–ø-—Å–µ—Ä–≤–µ—Ä–æ–º.

### **4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**  
```yaml
ignore_errors: yes
changed_when: sync_results.rc == 0 or sync_results.rc == 23
failed_when: sync_results.rc not in [0, 23, 24, 30]
```
- **`ignore_errors: yes`** ‚Äì –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ (–Ω–æ `failed_when` –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —ç—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ).  
- **–ö–æ–¥—ã –≤–æ–∑–≤—Ä–∞—Ç–∞ `rsync`:**  
  - `0` ‚Äì —É—Å–ø–µ—Ö,  
  - `23` ‚Äì —á–∞—Å—Ç–∏—á–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ–∞–π–ª—ã —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç),  
  - `24` ‚Äì –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏—Å—á–µ–∑–ª–∏ —Ñ–∞–π–ª—ã –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ–¥–∞—á–∏),  
  - `30` ‚Äì —Ç–∞–π–º–∞—É—Ç.  
- –ï—Å–ª–∏ –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ **–Ω–µ 0, 23, 24 –∏–ª–∏ 30** ‚Äì –∑–∞–¥–∞—á–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è **—É–ø–∞–≤—à–µ–π**.



## üöÄ **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç playbook?**
1. **–ù–∞—Ö–æ–¥–∏—Ç —Ñ–∞–π–ª—ã** (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ, –¥–∞–º–ø—ã –ë–î) –≤ `tmp_dumps.files`.  
2. **–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞:**  
   - –ö–æ–ø–∏—Ä—É–µ—Ç –µ–≥–æ –Ω–∞ –±—ç–∫–∞–ø-—Å–µ—Ä–≤–µ—Ä (`groups['targets'][0]`).  
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤–∏–¥–∞:  
     ```
     /usr/local/runtel/storage_files/telecoms/runtel.org/<–∏–º—è_—Ö–æ—Å—Ç–∞>/<–¥–∞—Ç–∞>/
     ```  
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–∞–≤–∞ (`--perms`), —Å–∂–∏–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (`compress: yes`).  
3. **–ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç** –∑–∞–¥–∞—á—É, –µ—Å–ª–∏:  
   - –ù–µ—Ç —Ñ–∞–π–ª–æ–≤ (`tmp_dumps.matched == 0`),  
   - –ù–µ—Ç SSH-–¥–æ—Å—Ç—É–ø–∞ (`ssh_check` –Ω–µ `success`).  
4. **–ù–µ —Å—á–∏—Ç–∞–µ—Ç –æ—à–∏–±–∫–æ–π** —á–∞—Å—Ç–∏—á–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ —Ç–∞–π–º–∞—É—Ç.



## üí° **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é**
- –ï—Å–ª–∏ `dest` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ, –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–ø–æ–ª–Ω—ã–π –ø—É—Ç—å —Å —Ö–æ—Å—Ç–æ–º**:  
  ```yaml
  dest: "{{ groups['targets'][0] }}:/usr/local/runtel/..."
  ```
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å `--partial` –≤ `rsync_opts` –¥–ª—è –¥–æ–∫–∞—á–∫–∏ —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –æ–±—Ä—ã–≤–∞—Ö.  
- –ï—Å–ª–∏ `archive: no`, –Ω–æ –Ω—É–∂–Ω—ã –ø—Ä–∞–≤–∞ (`--perms`), –º–æ–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å:  
  ```yaml
  perms: yes
  ```

## üîπ **–í—ã–≤–æ–¥**
–í–∞—à playbook **–Ω–∞–¥—ë–∂–Ω–æ –∫–æ–ø–∏—Ä—É–µ—Ç –¥–∞–º–ø—ã –Ω–∞ –±—ç–∫–∞–ø-—Å–µ—Ä–≤–µ—Ä**, –∏–≥–Ω–æ—Ä–∏—Ä—É—è –Ω–µ—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–∏–±–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `rsync` –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—É—Ç–∏ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤.
