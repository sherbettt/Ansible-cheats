 [Lookups](https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_lookups.html)

Этот код написан на языке Ansible, который используется для автоматизации настройки и управления серверами. Давайте разберём его по частям:

### 1. Секция `vars`:
```yaml
vars:
  motd_value: "{{ lookup('file', '/etc/motd') }}"
```
- Здесь определяется переменная с именем `motd_value`.
- Значение переменной получается с помощью плагина `lookup` типа `file`, который читает содержимое файла `/etc/motd`.
- `/etc/motd` - это стандартный файл в Unix/Linux системах, содержащий "Message Of The Day" (сообщение дня), которое обычно показывается пользователям при входе в систему.

### 2. Секция `tasks`:
```yaml
tasks:
  - debug:
      msg: "motd value is {{ motd_value }}"
```
- Здесь определяется задача (task), которая использует модуль `debug`.
- Модуль `debug` выводит сообщение во время выполнения playbook.
- В данном случае он выведет текст "motd value is " и затем содержимое переменной `motd_value` (то есть содержимое файла `/etc/motd`).

### Итоговое объяснение:
Этот Ansible код:
1. Читает содержимое файла `/etc/motd` с помощью плагина lookup
2. Сохраняет это содержимое в переменную `motd_value`
3. Выводит значение этой переменной с помощью модуля debug

Пример вывода, если в `/etc/motd` содержится "Добро пожаловать на сервер!":
```
motd value is Добро пожаловать на сервер!
```
Этот код может быть частью playbook'а для проверки или отладки содержимого MOTD на управляемых серверах.

-------
-------
Этот блок кода на Ansible демонстрирует два способа использования **lookup-плагинов** (или **query-плагинов**) для итерации по списку элементов. Оба варианта делают по сути одно и то же, но с разным синтаксисом. Давайте разберём его подробно.



## **1. Первая задача: `lookup` с `wantlist=True`**
```yaml
- debug:
    msg: "{{ item }}"
  loop: "{{ lookup('ns.col.lookup_items', wantlist=True) }}"
```
### **Что происходит?**
1. **`lookup('ns.col.lookup_items', wantlist=True)`**  
   - Это вызов lookup-плагина `ns.col.lookup_items` (предположительно, кастомного или из коллекции).
   - Параметр `wantlist=True` гарантирует, что результат всегда будет возвращён **в виде списка**, даже если элемент один.  
     *(Без этого, если lookup вернёт один элемент, он может быть передан как строка, а не список, что сломает `loop`.)*

2. **`loop`**  
   - Ansible перебирает каждый элемент из списка, возвращённого lookup-плагином.
   - Для каждого элемента выводится его значение через модуль `debug`.

### **Пример вывода**
Если `ns.col.lookup_items` вернёт `["item1", "item2", "item3"]`, то вывод будет:
```
ok: [localhost] => (item=item1) => {"msg": "item1"}
ok: [localhost] => (item=item2) => {"msg": "item2"}
ok: [localhost] => (item=item3) => {"msg": "item3"}
```



## **2. Вторая задача: `q` (сокращение для `query`)**
```yaml
- debug:
    msg: "{{ item }}"
  loop: "{{ q('ns.col.lookup_items') }}"
```
### **Что происходит?**
1. **`q('ns.col.lookup_items')`**  
   - `q` — это **сокращение** (alias) для `query`, который появился в Ansible 2.5+.
   - `query` работает почти так же, как `lookup`, но **всегда возвращает список** (аналог `wantlist=True`).  
   - Это более современный и предпочтительный способ, чем `lookup` + `wantlist`.

2. **`loop`**  
   - Аналогично первой задаче, перебирает элементы и выводит их через `debug`.

### **Пример вывода**
Если `ns.col.lookup_items` вернёт `["a", "b", "c"]`, то вывод будет:
```
ok: [localhost] => (item=a) => {"msg": "a"}
ok: [localhost] => (item=b) => {"msg": "b"}
ok: [localhost] => (item=c) => {"msg": "c"}
```



## **Ключевые отличия**
| Метод | Синтаксис | Всегда возвращает список? | Рекомендуется? |
|-------|----------|--------------------------|---------------|
| `lookup` | `lookup('ns.col.lookup_items', wantlist=True)` | Да (благодаря `wantlist`) | Устаревший способ |
| `query` (`q`) | `q('ns.col.lookup_items')` | Да (по умолчанию) | ✅ Современный способ |

### **Вывод**
- Обе задачи делают одно и то же: получают список элементов и выводят их по одному.
- **Первый вариант** использует `lookup` с явным `wantlist=True`, чтобы гарантировать список.
- **Второй вариант** использует `query` (или `q`), который делает то же самое, но короче и современнее.

**Рекомендация:**  
Лучше использовать `q()` или `query()`, так как это более новый и лаконичный синтаксис. `lookup` с `wantlist` — устаревший подход.

